# 《简易windows科学计算器》实验报告
#### 学院：软件学院  班级：2017级软工1班  学号：3017218062   姓名：刘书裴
#### 日期：  2019  年 6 月 7 日
## 一、功能概述
###### 输入一个合法计算式，计算出结果。

## 二、项目特色
###### 1、界面和操作类似于windows科学计算器；
###### 2、支持加减乘除模幂等普通运算和正反三角函数/指数对数/阶乘等特殊运算；
###### 3、支持大数运算；
###### 4、考虑了多种数学异常和程序异常，将数学计算精度损失尽量减少；
###### 5、每次计算会有相应的记录。

## 三、工作时间
###### 总共1周左右。

## 四、结论
#### 实验过程：
###### 1）界面设计
###### 对于window自带科学计算器：
![](https://github.com/cxdzb/SimpleCalculator/blob/master/readme_images/1.png?raw=true)
###### 删去不必要的功能：
![](https://github.com/cxdzb/SimpleCalculator/blob/master/readme_images/2.png?raw=true)

###### 2）后端设计
###### 新建Calculation类
![](https://github.com/cxdzb/SimpleCalculator/blob/master/readme_images/3.png?raw=true)
###### ①　result、priority、special_operators变量分别用于储存计算结果、运算符优先级、特殊运算符。
###### ②　IsNumeric函数用于判断是否是数字。
###### ③　Get_Result函数用于获取计算结果。其内部依次调用String_To_List、Infix_To_Postfix、Calculate，然后返回result。
###### ④　String_To_List函数用于将界面传入的字符串分割为数组。使用正则表达式将数字、运算符、特殊符号分割，存入数组。
###### ⑤　Infix_To_Postfix函数用于将分割后的中缀表达式数组转换为后缀表达式。使用栈进行转换，依次遍历中缀表达式数组：
###### -如果是数字，则加入后缀表达式；
###### -如果是特殊运算符和(，则加入栈；
###### -如果是),弹出栈中()内的运算符到后缀表达式；
###### -如果是普通运算符，优先级高于栈顶或栈空则压入栈，否则栈顶弹出加入后缀表达式。
###### 遍历结束后，将栈中剩余运算符加入后缀表达式。
###### ⑥　Calculate函数用于计算。Calculate函数相连的左边的三角函数、上方的普通运算和下方对数运算、阶乘运算内部实现了对应的数学运算。计算时依次遍历后缀表达式：
###### -如果是数字，入栈；
###### -如果是特殊运算符，弹出并运算栈顶一个元素后重新入栈；
###### -如果是普通运算符，弹出并运算栈顶两个元素后重新入栈；

###### 3）交互设计
###### 设置三个输入框（Formula、Input、Current），新建Infix类
![](https://github.com/cxdzb/SimpleCalculator/blob/master/readme_images/4.png?raw=true)
###### ①　current、input、formula成员变量分别用于储存当前时间、输入字符串、计算表达式。
###### ②　Current、Input、Formula属性分别用于设置和获取current、input、formula。其内部实现PropertyChanged，并且分别绑定界面的三个输入框，实现了数据绑定，使其值与界面显示值同步。Current使用timer获取，每隔0.1s获取一次，而使用线程，防止跨线程调用而出错。

###### 4）数据范围
###### Windows计算器是可以实现大数计算，因此，我使用.net框架的BigInteger实现整数大数运算，而C#的double范围比较大，无须实现。

###### 5）异常处理
###### ①　除0异常：在除数为0时抛出异常；
###### ②　负数平方根异常：在开平方根时底数不能为负；
###### ③　非负数对数异常：对数运算时底数不能为非负数；
###### ④　负数阶乘异常：阶乘运算时底数不能为负；
###### ⑤　Tan的π/2异常：正弦函数参数不能为π/2+kπ；
###### ⑥　反三角的范围异常：arcsin与arccos参数在[-1,1]；
###### ⑦　浮点数精度异常：类似与1.000000000001和1.99999999999这种，必须化为整数。

###### 6）按钮点击
###### 点击按钮事件实际是current、input、formula的改变。而=按钮对应着Infix.Get_Result函数。

###### 7）其他功能
###### ①　三个清除键（C/CE/Del）：分别清空或修改Infix类的成员变量值即可；
###### ②　历史记录：在每次计算成功后，将计算式和结果放入对应容器中；
###### ③　输入方式：可以点击按钮输入，也可以直接修改输入框内容输入，注意字符。
#### 实验结果：

